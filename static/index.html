<!DOCTYPE html>
<html>
<head>
    <title>k-means clustering</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js">/* JQuery */</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js">/* Chart.js */</script>
    <script src="https://cdn.jsdelivr.net/gh/chartjs/Chart.js/samples/utils.js">/* Chart.js utils*/</script>
</head>

<body>
    <canvas id="myChart" width="640", height="360"></canvas>
</body>

<script>

var chart;
var color = Chart.helpers.color;

function createChart(data) {
    var canvas = document.getElementById("myChart");
    var ctx = canvas.getContext('2d');

    /*
    var container = canvas.parent();
    c.attr('width', container.width());
    c.attr('height', container.height());
    */
   var chartData = {
        datasets: [{
            label: 'Scatter Dataset',
            borderColor: window.chartColors.blue,
            backgroundColor: color(window.chartColors.blue).alpha(0.2).rgbString(),
            data: data
        }]
    };

    chart = new Chart(ctx, {
        type: 'scatter',
        data: chartData,
        options: {
            scales: {
                xAxes: [{
                    type: 'linear',
                    position: 'bottom'
                }]
            }
        }
    });
}


function chartAddDataset(dataset) {
    chart.data.datasets.push(dataset);
    chart.update();
}

function queryKMeans() {
    $.ajax({
        url: "api/kmeans",
        method: 'GET',
        dataType: 'json',
        data: {}, 
        success: function(responseData) {
            if("Data" in responseData) {
                var dataset = {
                    label: "Centroids",
                    borderColor: window.chartColors.red,
                    backgroundColor: color(window.chartColors.red).alpha(0.8).rgbString(),
                    data: responseData["Data"],
                };
                chartAddDataset(dataset);
            }
            else if ("Error" in responseData) {
                console.log(responseData["Error"])
            }
        }
    })
}


$(document).ready(function() {
    $.ajax({
        url: "api/data",
        method: 'GET',
        dataType: 'json',
        success: function(responseData) {
            if("Data" in responseData) {
                createChart(responseData["Data"]);
                queryKMeans();
            }
            else if ("Error" in responseData) {
                console.log(responseData["Error"])
            }
        }
    })

});

</script>
</html> 
